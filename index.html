<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <title>RECLAIM FPS</title>
  </head>
  <body>
    <div id="app"></div>

    <div id="hud">
      <div class="hud-left">
        <div>체력 <span id="hud-health">100</span></div>
        <div class="hud-health-bar-wrap"><div id="hud-health-bar"></div></div>
        <div>점수 <span id="hud-score">0</span></div>
        <div>처치 <span id="hud-kills">0</span></div>
      </div>
      <div class="hud-right">
        <div>탄약 <span id="hud-ammo">30</span>/<span id="hud-reserve">150</span></div>
        <div id="hud-status">준비</div>
        <div>위협 <span id="hud-enemies">0</span></div>
        <div>탈취 <span id="hud-captures">0</span></div>
        <div>거점 <span id="hud-control">0%</span></div>
        <div id="hud-objective">목표: 적 깃발을 확보하세요</div>
        <div id="hud-threat"></div>
        <div id="hud-streak"></div>
      </div>
    </div>

    <div id="chat-panel" aria-label="전체 채팅">
      <div class="chat-header">
        <span>전체 채팅</span>
        <span id="chat-myname" class="chat-myname"></span>
      </div>
      <div id="chat-messages" aria-live="polite"></div>
      <div class="chat-input-wrap">
        <input
          id="chat-input"
          type="text"
          placeholder="T 키 또는 클릭으로 채팅"
          maxlength="200"
          autocomplete="off"
          spellcheck="false"
        />
        <button id="chat-send" type="button">전송</button>
      </div>
    </div>

    <div id="crosshair" aria-hidden="true"></div>
    <div id="hitmarker" aria-hidden="true"></div>
    <div id="damage-overlay" aria-hidden="true"></div>

    <div id="build-hud" aria-hidden="true">
      <div id="build-mode-badge">모드: 총</div>
      <div id="block-hotbar">
        <div class="hotbar-slot is-selected" data-slot="1" title="NumPad1 - 잔디">
          <span class="swatch swatch-grass"></span>
          <span class="slot-key">N1</span>
        </div>
        <div class="hotbar-slot" data-slot="2" title="NumPad2 - 흙">
          <span class="swatch swatch-dirt"></span>
          <span class="slot-key">N2</span>
        </div>
        <div class="hotbar-slot" data-slot="3" title="NumPad3 - 돌">
          <span class="swatch swatch-stone"></span>
          <span class="slot-key">N3</span>
        </div>
        <div class="hotbar-slot" data-slot="4" title="NumPad4 - 모래">
          <span class="swatch swatch-sand"></span>
          <span class="slot-key">N4</span>
        </div>
        <div class="hotbar-slot" data-slot="5" title="NumPad5 - 점토">
          <span class="swatch swatch-clay"></span>
          <span class="slot-key">N5</span>
        </div>
        <div class="hotbar-slot" data-slot="6" title="NumPad6 - 벽돌">
          <span class="swatch swatch-brick"></span>
          <span class="slot-key">N6</span>
        </div>
        <div class="hotbar-slot" data-slot="7" title="NumPad7 - 얼음">
          <span class="swatch swatch-ice"></span>
          <span class="slot-key">N7</span>
        </div>
        <div class="hotbar-slot" data-slot="8" title="NumPad8 - 금속">
          <span class="swatch swatch-metal"></span>
          <span class="slot-key">N8</span>
        </div>
      </div>
    </div>

    <div id="mobile-controls" aria-hidden="true">
      <div id="mobile-joystick" aria-label="Move joystick">
        <div class="mobile-joystick-ring"></div>
        <div id="mobile-joystick-knob"></div>
      </div>
      <div id="mobile-utility" aria-label="Mobile actions">
        <button id="mobile-mode-place" class="mobile-utility-btn" type="button">설치</button>
        <button id="mobile-mode-dig" class="mobile-utility-btn" type="button">삽</button>
        <button id="mobile-mode-gun" class="mobile-utility-btn" type="button">총</button>
        <button id="mobile-aim" class="mobile-utility-btn" type="button">조준</button>
        <button id="mobile-jump" class="mobile-utility-btn" type="button">점프</button>
        <button id="mobile-reload" class="mobile-utility-btn" type="button">장전</button>
      </div>
      <button id="mobile-fire" type="button" aria-label="Fire">
        FIRE
      </button>
    </div>

    <div id="start-overlay" class="overlay show overlay-start">
      <section class="start-panel">
        <div class="start-header">
          <img
            class="start-emblem"
            src="/assets/graphics/ui/logo.svg"
            alt="RECLAIM logo"
            loading="eager"
            decoding="async"
          />
          <p class="start-kicker">작전명: FRONTLINE RECOVERY</p>
          <h1>RECLAIM FPS</h1>
        </div>

        <nav class="start-tabs" role="tablist" aria-label="game mode">
          <button
            id="mode-online"
            class="tab-btn is-active"
            role="tab"
            aria-selected="true"
            type="button"
          >
            온라인
          </button>
          <button
            id="mode-single"
            class="tab-btn"
            role="tab"
            aria-selected="false"
            type="button"
          >
            훈련장
          </button>
        </nav>

        <div id="online-panel" class="tab-panel" role="tabpanel">
          <p class="start-desc">상시 GLOBAL 방에 자동 접속됩니다. 최대 50명까지 참여할 수 있습니다.</p>

          <div class="mp-nick-row">
            <label class="mp-label" for="mp-name">닉네임</label>
            <input
              id="mp-name"
              class="mp-input"
              type="text"
              maxlength="16"
              placeholder="닉네임 입력"
              autocomplete="off"
            />
          </div>

          <div class="mp-status-bar">
            <span id="mp-status" class="mp-status-text">서버: 연결 대기</span>
            <div class="mp-status-actions">
              <button id="mp-refresh" class="mp-icon-btn" type="button">새로고침</button>
            </div>
          </div>

          <div id="mp-room-list" class="mp-room-list">
            <div class="mp-empty">GLOBAL 방 상태 확인중...</div>
          </div>

          <div id="mp-lobby" class="mp-lobby hidden">
            <div class="mp-lobby-head">
              <div class="mp-room-meta">
                <div id="mp-room-title" class="mp-lobby-title">GLOBAL</div>
                <div id="mp-room-subtitle" class="mp-room-subtitle">자동 매칭</div>
              </div>
            </div>
            <div id="mp-player-list" class="mp-player-list">
              <div class="mp-empty">플레이어를 기다리는 중...</div>
            </div>
            <div class="mp-team-row">
              <button id="mp-team-alpha" class="mp-team-btn alpha" type="button">
                알파 <span id="mp-team-alpha-count" class="team-count">0</span>
              </button>
              <button id="mp-team-bravo" class="mp-team-btn bravo" type="button">
                브라보 <span id="mp-team-bravo-count" class="team-count">0</span>
              </button>
            </div>
            <button id="mp-start" class="btn-deploy" type="button" disabled>온라인 시작</button>
          </div>
        </div>

        <div id="single-panel" class="tab-panel hidden" role="tabpanel">
          <p class="start-desc">훈련장에서 이동, 조준, 블록 건설과 전투를 연습하세요.</p>
          <div class="controls-grid">
            <div class="ctrl-item"><kbd>W A S D</kbd><span>이동</span></div>
            <div class="ctrl-item"><kbd>SHIFT</kbd><span>달리기</span></div>
            <div class="ctrl-item"><kbd>SPACE</kbd><span>점프</span></div>
            <div class="ctrl-item"><kbd>MOUSE</kbd><span>시점 조작</span></div>
            <div class="ctrl-item"><kbd>1 / 2 / 3</kbd><span>설치 / 제거 / 총 모드</span></div>
            <div class="ctrl-item"><kbd>LMB</kbd><span>행동(설치/제거/공격)</span></div>
            <div class="ctrl-item"><kbd>RMB</kbd><span>총 모드 조준</span></div>
            <div class="ctrl-item"><kbd>R / NumPad1-8</kbd><span>장전 / 블록 선택</span></div>
          </div>
          <button id="start-button" class="btn-deploy" type="button">훈련 시작</button>
        </div>
      </section>
    </div>

    <div id="pause-overlay" class="overlay overlay-pause">
      <h2>일시정지</h2>
      <p>화면을 클릭하면 게임을 다시 진행합니다.</p>
    </div>

    <div id="gameover-overlay" class="overlay overlay-gameover">
      <h2>게임 오버</h2>
      <p>최종 점수: <span id="final-score">0</span></p>
      <button id="restart-button" type="button">다시 시작</button>
    </div>

    <script>
      (function () {
        var BOOT_TIMEOUT_MS = 4500;
        var guard = {
          moduleLoaded: false,
          bootStarted: false,
          bootReady: false,
          error: ""
        };
        window.__reclaimBootGuard = guard;

        function showHelp(reason) {
          if (document.getElementById("boot-help")) {
            return;
          }

          var root = document.createElement("div");
          root.id = "boot-help";
          root.style.position = "fixed";
          root.style.inset = "0";
          root.style.zIndex = "9999";
          root.style.display = "grid";
          root.style.placeItems = "center";
          root.style.padding = "18px";
          root.style.background = "rgba(4, 10, 18, 0.92)";
          root.style.color = "#ffe4e4";
          root.innerHTML =
            '<div style="max-width:720px;width:100%;border:1px solid rgba(255,120,120,0.5);border-radius:12px;background:rgba(15,20,32,0.92);padding:16px 18px;font-family:Segoe UI, sans-serif;">' +
            '<h2 style="margin:0 0 8px 0;font-size:18px;">RECLAIM FPS 실행 점검</h2>' +
            '<p style="margin:0 0 10px 0;font-size:14px;line-height:1.45;">게임 시작 중 오류가 발생했습니다.</p>' +
            '<pre style="margin:0 0 10px 0;white-space:pre-wrap;word-break:break-word;font-size:13px;line-height:1.45;color:#ffd0d0;">' +
            String(reason || "알 수 없는 시작 오류") +
            "</pre>" +
            '<div style="font-size:13px;line-height:1.5;color:#e7ecff;">' +
            "로컬 실행은 Vite 개발 서버를 사용하세요:<br>" +
            "1) npm install<br>" +
            "2) npm run dev:all<br>" +
            "3) Vite가 보여주는 주소로 접속 (기본 http://localhost:5173)<br><br>" +
            "루트 index.html을 Live Server(예: 127.0.0.1:5500)로 직접 열지 마세요." +
            "</div>" +
            "</div>";
          document.body.appendChild(root);
        }

        window.addEventListener(
          "error",
          function (event) {
            if (guard.bootReady) {
              return;
            }
            if (event && event.message && !guard.error) {
              guard.error = String(event.message);
            }
          },
          true
        );

        window.setTimeout(function () {
          if (guard.bootReady) {
            return;
          }

          var reason = guard.error;
          if (!reason && !guard.moduleLoaded) {
            reason =
              "메인 모듈 로딩 실패: 잘못된 서버 또는 MIME 설정일 가능성이 높습니다.";
          } else if (!reason && guard.moduleLoaded && !guard.bootStarted) {
            reason = "메인 모듈은 로드되었지만 부트가 시작되지 않았습니다.";
          } else if (!reason && guard.moduleLoaded && guard.bootStarted) {
            reason = "부트가 시작되었지만 완료되지 않았습니다.";
          }

          showHelp(reason);
        }, BOOT_TIMEOUT_MS);
      })();
    </script>
    <script type="module" src="/src/main.js"></script>
  </body>
</html>
